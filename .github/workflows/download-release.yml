name: Download Release

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'ç‰ˆæœ¬å· (æ ¼å¼: YYYYMMDD æˆ– latest)'
        required: true
        type: string
        default: 'latest'
      include_fct:
        description: 'åŒ…å« FCT æ–‡ä»¶å¤¹'
        required: false
        type: boolean
        default: true
      include_welcome:
        description: 'åŒ…å« Welcome æ–‡ä»¶å¤¹'
        required: false
        type: boolean
        default: true
      include_fixture:
        description: 'åŒ…å« Fixture æ–‡ä»¶å¤¹'
        required: false
        type: boolean
        default: true
      include_maintain:
        description: 'åŒ…å« Maintain æ–‡ä»¶å¤¹'
        required: false
        type: boolean
        default: true
      include_docs:
        description: 'åŒ…å«æ–‡æ¡£æ–‡ä»¶ (release.md, review.md)'
        required: false
        type: boolean
        default: true

jobs:
  download-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Prepare Download Package
        id: prepare
        run: node scripts/prepare-download.js
        env:
          VERSION: ${{ inputs.version }}
          INCLUDE_FCT: ${{ inputs.include_fct }}
          INCLUDE_WELCOME: ${{ inputs.include_welcome }}
          INCLUDE_FIXTURE: ${{ inputs.include_fixture }}
          INCLUDE_MAINTAIN: ${{ inputs.include_maintain }}
          INCLUDE_DOCS: ${{ inputs.include_docs }}

      - name: Upload Release Artifact
        uses: actions/upload-artifact@v4
        with:
          name: release-${{ env.ACTUAL_VERSION }}-${{ github.run_number }}
          path: download-package/
          retention-days: 7
          if-no-files-found: error

      - name: Summary
        run: |
          echo "## ðŸ“¦ ä¸‹è½½åŒ…å·²ç”Ÿæˆ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **ç‰ˆæœ¬**: ${{ env.ACTUAL_VERSION }}" >> $GITHUB_STEP_SUMMARY
          echo "- **åŒ…å«åŠŸèƒ½**: ${{ env.INCLUDED_FEATURES }}" >> $GITHUB_STEP_SUMMARY
          echo "- **æ–‡ä»¶æ•°é‡**: ${{ env.FILE_COUNT }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "è¯·åœ¨ Actions é¡µé¢çš„ Artifacts åŒºåŸŸä¸‹è½½ã€‚" >> $GITHUB_STEP_SUMMARY
